<?php
    NavBar::begin([
        'brandLabel' => 'ADVENTURE',
        'brandUrl' => Yii::$app->homeUrl,
        'innerContainerOptions' => ['class' => 'container-fluid'],
        'options' => [
            'class' => 'navbar-dark navbar-custom navbar-expand-lg py-1 fixed-top',
        ],
        'collapseOptions' => [
            'class' => 'justify-content-end',
        ],
    ]);

?> <div id="select2"> <?php
  echo Select2::widget([
        'name' => 'kv-repo-template',
        'pluginOptions' => [
            'placeholder' => Icon::show('search')."Buscar usuario",
            // 'width' => '20%',
            'ajax' => [
                'url' => $url,
                'dataType' => 'json',
                'data' => new JsExpression('function(params) { 
                    return {q: params.term};
                }'),
            ],
            'escapeMarkup' => new JsExpression('function (markup) { 
               return markup;
            }'),
            'templateResult' => new JsExpression('function(params) {
                $var = params.id;
                imgenlace = \'<span><img class="small-circular-photo" src="https://picsum.photos/100/100?random=\'+$var+\'"/></span>\'+
                "<i class=\'enlace-select2\'>"+params.text+"</i>";
                return imgenlace;
            }'),
        ],
        'pluginEvents' => [
            "select2:select" => "function(e) { 
                e.preventDefault();
                texto = $(this).text();
                window.location.href = href='$url2'+texto;
            }",
            "select2:open" => "function(e) { 
                e.preventDefault();
                texto = $(this).text('');
                $(this).hide();
            }",
        ],
    ]);
?> </div> <?php 

    $items = [];
    if(Yii::$app->user->isGuest) {
        $items = [
            [
                'label' => Html::button('Login', 
                    [   
                        'value' => Url::toRoute(['site/login']),  
                        'class' => 'btn btn-info login', 
                        'id' => 'login'
                    ]) 
            ],
            [
                'label' => Html::button('Registrar', 
                    [   
                        'value' => Url::to(['usuarios/registrar']),  
                        'class' => 'btn btn-info', 
                        'id' => 'registrar'
                    ]) 
            ]
        ];
    } else  {
        $items = [
            Html::beginForm(['site/logout'], 'post').Html::submitButton(
            'Logout ' . Html::tag('i', Icon::show('power-off'), ['class' => '']).'',
            ['class' => 'dropdown-item'],).Html::endForm(),
            ['label' => 'Perfil', 'url' => ['usuarios/view', 'alias' => Yii::$app->user->identity->alias]]
        ];
        
    }
    
    
    echo Nav::widget([
        'options' => ['class' => 'navbar-nav navbar-right'],
        'encodeLabels' => false,
        'items' => [
            [
                'label' => Html::tag('i', Icon::show('envelope'), ['class' => '',]),
                'visible' => !$guest,
            ],
            [
                'label' => Html::tag('i', Icon::show('bell'), ['class' => '',]),
                'visible' => !$guest,
            ],
            [
                'label' => '<div class="vertical-minus">'.Html::tag('i', Icon::show('minus')).'</div>',
                'visible' => !$guest,
                'options' => ['class' => 'label-vertical-minus']
            ],
            [
                'label' => 'Comunidades',
                'options' => ['style' => 'padding-left:10px;'],
                'url' => ['comunidades/index'],
            ],
            [
                'label' =>  (!Yii::$app->user->isGuest) ? ucfirst(Yii::$app->user->identity->alias) .' '. 
                 Html::tag('i', Icon::show('user'), ['class' => '',]) : 'Iniciar sesiÃ³n',
                'items' => $items,
            ],
            
        ],
    ]);
    NavBar::end();
    ?>



<nav id="w0" class="navbar-dark navbar-custom navbar-expand-lg py-1 fixed-top navbar">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">ADVENTURE</a>
           
        
        <ul id="w2" class="navbar-nav navbar-right nav">
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="">
                        <i class="fas fa-envelope"></i> 
                    </i>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <i class="">
                        <i class="fas fa-bell"></i>
                     </i>
                </a>
            </li>
            <li class="label-vertical-minus nav-item">
                <a class="nav-link" href="#">
                    <div class="vertical-minus">
                        <i>
                            <i class="fas fa-minus"></i>
                        </i>
                    </div>
                </a>
            </li>
            <li class="nav-item" style="padding-left:10px;">
                <a class="nav-link" href="/comunidad/inicio">Comunidades</a>
            </li>
            <li class="dropdown nav-item">
                <a class="dropdown-toggle nav-link" href="#" data-toggle="dropdown">
                    Admin <i class=""> <i class="fas fa-user"></i></i>
                </a>
                <div id="w3" class="dropdown-menu">
                    <form action="/site/logout" method="post">
                        <input type="hidden" name="_csrf" value="puTrCw7uRFfwcV3Zjf_VU3dcmzcAxgfXIV-w60UUdaD8ktJFT9wIDbYHK5Kgq4wcRBDfdGacXZQRHoCvMlc-kA==">
                        <button type="submit" class="dropdown-item">Logout <i class=""><i class="fas fa-power-off"></i></i></button>
                    </form>
                        <a class="dropdown-item" href="/perfil/usuario/admin">Perfil</a>
                </div>
            </li>
        </ul>
    </div>
</nav>
